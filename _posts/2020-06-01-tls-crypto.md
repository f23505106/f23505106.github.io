---
layout: post
title: "tlsä¸å¯†ç å­¦åŸºç¡€"
categories: [crypto,ssl,tls]
mathjax: true
---
# tlsä¸å¯†ç å­¦åŸºç¡€

## æ€»è§ˆ

## RSA
rsaçš„æ•°å­¦æ¨¡å‹å¦‚ä¸‹

$$m^{e \times d} \pmod n \equiv m \tag$$

åŠ å¯†è¿‡ç¨‹

$$m^e \pmod n = c \tag$$

è§£ç§˜è¿‡ç¨‹

$$c^d \pmod n = m$$

å…¶ä¸­
* **m**å¾…åŠ å¯†çš„æ¶ˆæ¯
* **c**åŠ å¯†åçš„å¯†æ–‡
* **nå’Œe**å…¬é’¥
* **nå’Œd**ç§é’¥

å¯†é’¥çš„ç”Ÿæˆä¹Ÿå°±æ˜¯æ‰¾åˆ°**n e d**ä¸‰ä¸ªå€¼ã€‚

è§£é‡Šï¼ˆä¸é‡è¦ï¼Œç†è§£på’Œqå°±å¯ä»¥ï¼Œè¿™ä¸ªä¼šåœ¨keyæ–‡ä»¶é‡Œå‡ºç°ï¼‰

ä¸€ã€äº’è´¨å…³ç³»

å¦‚æœä¸¤ä¸ªæ­£æ•´æ•°ï¼Œé™¤äº†1ä»¥å¤–ï¼Œæ²¡æœ‰å…¶ä»–å…¬å› å­ï¼Œæˆ‘ä»¬å°±ç§°è¿™ä¸¤ä¸ªæ•°æ˜¯äº’è´¨å…³ç³»ã€‚æ¯”å¦‚ï¼Œ17å’Œ32æ²¡æœ‰å…¬å› å­ï¼Œæ‰€ä»¥å®ƒä»¬æ˜¯äº’è´¨å…³ç³»ã€‚è¿™è¯´æ˜ï¼Œä¸æ˜¯è´¨æ•°ä¹Ÿå¯ä»¥æ„æˆäº’è´¨å…³ç³»ã€‚

å…³äºäº’è´¨å…³ç³»ï¼Œä¸éš¾å¾—åˆ°ä»¥ä¸‹ç»“è®ºï¼š

* ä»»æ„ä¸¤ä¸ªè´¨æ•°æ„æˆäº’è´¨å…³ç³»ï¼Œæ¯”å¦‚13å’Œ61ã€‚
* ä¸€ä¸ªæ•°æ˜¯è´¨æ•°ï¼Œå¦ä¸€ä¸ªæ•°åªè¦ä¸æ˜¯å‰è€…çš„å€æ•°ï¼Œä¸¤è€…å°±æ„æˆäº’è´¨å…³ç³»ï¼Œæ¯”å¦‚3å’Œ10ã€‚
* å¦‚æœä¸¤ä¸ªæ•°ä¹‹ä¸­ï¼Œè¾ƒå¤§çš„é‚£ä¸ªæ•°æ˜¯è´¨æ•°ï¼Œåˆ™ä¸¤è€…æ„æˆäº’è´¨å…³ç³»ï¼Œæ¯”å¦‚97å’Œ57ã€‚
* 1å’Œä»»æ„ä¸€ä¸ªè‡ªç„¶æ•°æ˜¯éƒ½æ˜¯äº’è´¨å…³ç³»ï¼Œæ¯”å¦‚1å’Œ99ã€‚
* pæ˜¯å¤§äº1çš„æ•´æ•°ï¼Œåˆ™på’Œp-1æ„æˆäº’è´¨å…³ç³»ï¼Œæ¯”å¦‚57å’Œ56ã€‚
* pæ˜¯å¤§äº1çš„å¥‡æ•°ï¼Œåˆ™på’Œp-2æ„æˆäº’è´¨å…³ç³»ï¼Œæ¯”å¦‚17å’Œ15ã€‚

äºŒã€æ¬§æ‹‰å‡½æ•°

ä»»æ„ç»™å®šæ­£æ•´æ•°nï¼Œè¯·é—®åœ¨å°äºç­‰äºnçš„æ­£æ•´æ•°ä¹‹ä¸­ï¼Œæœ‰å¤šå°‘ä¸ªä¸næ„æˆäº’è´¨å…³ç³»ï¼Ÿï¼ˆæ¯”å¦‚ï¼Œåœ¨1åˆ°8ä¹‹ä¸­ï¼Œæœ‰å¤šå°‘ä¸ªæ•°ä¸8æ„æˆäº’è´¨å…³ç³»ï¼Ÿï¼‰
è®¡ç®—è¿™ä¸ªå€¼çš„æ–¹æ³•å°±å«åšæ¬§æ‹‰å‡½æ•°ï¼Œä»¥Ï†(n)è¡¨ç¤ºã€‚åœ¨1åˆ°8ä¹‹ä¸­ï¼Œä¸8å½¢æˆäº’è´¨å…³ç³»çš„æ˜¯1ã€3ã€5ã€7ï¼Œæ‰€ä»¥ Ï†(n) = 4ã€‚
å¦‚æœnæ˜¯è´¨æ•°ï¼Œåˆ™ Ï†(n)=n-1 ã€‚å› ä¸ºè´¨æ•°ä¸å°äºå®ƒçš„æ¯ä¸€ä¸ªæ•°ï¼Œéƒ½æ„æˆäº’è´¨å…³ç³»ã€‚æ¯”å¦‚5ä¸1ã€2ã€3ã€4éƒ½æ„æˆäº’è´¨å…³ç³»

ä¸‰ã€æ¬§æ‹‰å®šç†

æ¬§æ‹‰å‡½æ•°çš„ç”¨å¤„ï¼Œåœ¨äºæ¬§æ‹‰å®šç†ã€‚â€æ¬§æ‹‰å®šç†â€æŒ‡çš„æ˜¯ï¼š
å¦‚æœä¸¤ä¸ªæ­£æ•´æ•°må’Œnäº’è´¨ï¼Œåˆ™nçš„æ¬§æ‹‰å‡½æ•° Ï†(n) å¯ä»¥è®©ä¸‹é¢çš„ç­‰å¼æˆç«‹:

$$m^{\phi(n)} \equiv 1\pmod n$$

å³

$$m^{\phi(n)}\pmod n = 1$$

å€ŸåŠ©æ¬§æ‹‰å®šç†ï¼Œå¯ä»¥ä½¿æ‰¾åˆ°åˆé€‚çš„**n e d**å˜å¾—ç®€å•

æ³›åŒ–

$$m^{k \phi(n)}\pmod n = 1$$

kæ˜¯ä»»æ„æ•´æ•°

æ¬§æ‹‰å®šç†ä¸¤é¢åŒæ—¶ä¹˜äºmçš„åˆ°

$$m^{k \phi(n)+1} \pmod n = m$$


å¯ä»¥çœ‹åˆ°**k &phi;(n)+1**å°±æ˜¯æƒ³å¾—åˆ°çš„ **e x d**


ä¸ºäº†æ–¹ä¾¿è®¡ç®—**k &phi;(n)+1**å– è´¨æ•°**p q** ä½¿**n=p x q**åŒæ—¶å–è´¨æ•°**e**(å¸¸ç”¨3æˆ–65537)

**k &phi;(n)+1 = e x d -> k(p-1)(q-1)+1 = e x d** å…¶ä¸­p q eä¸ºå·²çŸ¥ï¼Œk dä¸ºæœªçŸ¥ï¼Œè¿™ä¸ªæ–¹ç¨‹å¯ä»¥ç”¨"æ‰©å±•æ¬§å‡ é‡Œå¾—ç®—æ³•"æ±‚è§£ã€‚

**æ³¨æ„** eåœ¨é€‰å–æ—¶éœ€è¦å’Œ &phi;(n)äº’è´¨ã€‚

ç»¼åˆä»¥ä¸Š åœ¨ä¸€ä¸ªrsaçš„ç§é’¥é‡Œä¼šå­˜å‚¨å¦‚ä¸‹ä¿¡æ¯ï¼Œ[rfcå®šä¹‰](https://tools.ietf.org/html/rfc3447#appendix-A.1.1)

```
RSAPrivateKey ::= SEQUENCE {
    version           Version,
    modulus           INTEGER,  -- n  Modulus (ğ‘›=ğ‘ğ‘)
    publicExponent    INTEGER,  -- e  Public exponent (ğ‘’)
    privateExponent   INTEGER,  -- d  Private exponent (ğ‘‘=ğ‘’âˆ’1(modğœ™(ğ‘›)))
    prime1            INTEGER,  -- p  First prime (ğ‘)
    prime2            INTEGER,  -- q  Second prime (ğ‘)
    exponent1         INTEGER,  --    First exponent, used for Chinese remainder theorem (ğ‘‘ğ‘ƒ=ğ‘‘(modğ‘âˆ’1))
    exponent2         INTEGER,  --    Second exponent, used for CRT (ğ‘‘ğ‘„=ğ‘‘(modğ‘âˆ’1))
    coefficient       INTEGER,  --    Coefficient, used for CRT (ğ‘inv=ğ‘âˆ’1(modğ‘))
    otherPrimeInfos   OtherPrimeInfos OPTIONAL
}
```
å¯¹åº”å…¬é’¥æ ¼å¼å¦‚ä¸‹

```
RSAPublicKey:

RSAPublicKey ::= SEQUENCE {
    modulus           INTEGER,  -- n
    publicExponent    INTEGER   -- e
}
```
é€‰æ‹©å¦‚ä¸‹keyè®¾ç½®ï¼Œå­˜å‚¨ä¸ºæ–‡ä»¶`my.rsa`

```
asn1=SEQUENCE:rsa_key

[rsa_key]
version=INTEGER:0
modulus=INTEGER:55
pubExp=INTEGER:7
privExp=INTEGER:23
p=INTEGER:5
q=INTEGER:11
e1=INTEGER:3
e2=INTEGER:3
coeff=INTEGER:1
```
ä½¿ç”¨`openssl asn1parse -genconf my.rsa -out my.der`è½¬åŒ–ä¸ºderæ ¼å¼çš„æ–‡ä»¶
å¯¹åº”æ–‡ä»¶å†…å®¹ä¸º

```
hexdump my.der
0000000 30 1b 02 01 00 02 01 37 02 01 07 02 01 17 02 01
0000010 05 02 01 0b 02 01 03 02 01 03 02 01 01         
000001d
```
è¯¥æ–‡ä»¶å…·ä½“æ ¼å¼ä¸º

```
openssl rsa -in my.der -inform der -text -check
Private-Key: (6 bit)
modulus: 55 (0x37)
publicExponent: 7 (0x7)
privateExponent: 23 (0x17)
prime1: 5 (0x5)
prime2: 11 (0xb)
exponent1: 3 (0x3)
exponent2: 3 (0x3)
coefficient: 1 (0x1)
RSA key ok
writing RSA key
-----BEGIN RSA PRIVATE KEY-----
MBsCAQACATcCAQcCARcCAQUCAQsCAQMCAQMCAQE=
-----END RSA PRIVATE KEY-----
```
æœ€ä¸‹é¢ä¸ºå¯¹åº”äºŒè¿›åˆ¶æ–‡ä»¶çš„base64å­—ç¬¦ä¸²











